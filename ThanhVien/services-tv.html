<!DOCTYPE html>
<html lang="zxx">

<head>
  <meta charset="UTF-8">
  <meta name="description" content="Gym Template">
  <meta name="keywords" content="Gym, unica, creative, html">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>GymLy | Gói tập TV</title>

  <link href="https://fonts.googleapis.com/css?family=Muli:300,400,500,600,700,800,900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Oswald:300,400,500,600,700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="../css/bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="../css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="../css/flaticon.css" type="text/css">
  <link rel="stylesheet" href="../css/owl.carousel.min.css" type="text/css">
  <link rel="stylesheet" href="../css/barfiller.css" type="text/css">
  <link rel="stylesheet" href="../css/magnific-popup.css" type="text/css">
  <link rel="stylesheet" href="../css/slicknav.min.css" type="text/css">
  <link rel="stylesheet" href="../css/style.css" type="text/css">

  <style>
    /* Popup chung */
    .service-popup-modern {
      max-width: 900px;
      margin: 40px auto;
      background: #fff;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      font-family: 'Muli', sans-serif;
      /* Font chữ gốc là Muli */
    }

    .popup-title {
      font-family: 'Oswald', sans-serif;
      /* Tiêu đề chính là Oswald */
      font-weight: 600;
      color: #222;
      font-size: 2rem;
      margin-bottom: 8px;
    }

    .popup-code {
      color: #e74c3c;
      font-weight: 500;
      margin-bottom: 20px;
    }

    .popup-description {
      color: #666;
      font-size: 1rem;
      line-height: 1.7;
    }

    /* Tiêu đề mục (Lợi ích, Quyền lợi, HLV) */
    .section-subtitle {
      font-family: 'Oswald', sans-serif;
      /* Đặt font Oswald rõ ràng */
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
      font-size: 1.2rem;
      /* Tăng kích thước 1 chút */
      display: flex;
      align-items: center;
    }

    /* Danh sách bullet */
    .benefit-list,
    .feature-list {
      padding-left: 20px;
      line-height: 1.7;
      /* Giảm khoảng cách dòng */
      color: #555;
      font-size: 0.95rem;
      /* Đặt cỡ chữ rõ ràng */
      font-family: 'Muli', sans-serif;
      /* Đảm bảo là Muli */
    }

    .benefit-list li::marker,
    .feature-list li::marker {
      color: #27ae60;
    }

    /* Thông tin HLV */
    .trainer-name {
      font-family: 'Muli', sans-serif;
      /* Rõ ràng là Muli */
      font-weight: 700;
      /* Đậm hơn */
      color: #222;
      margin: 8px 0 4px;
      font-size: 1.1rem;
    }

    .trainer-desc {
      font-family: 'Muli', sans-serif;
      /* Rõ ràng là Muli */
      color: #777;
      font-style: italic;
      font-size: 0.9rem;
    }

    /* CSS cho hiển thị nhiều HLV */
    .trainer-item {
      margin-bottom: 15px;
      /* Khoảng cách giữa các HLV */
    }

    .trainer-item:last-child {
      margin-bottom: 0;
      /* Không có khoảng cách ở HLV cuối */
    }

    .trainer-item .trainer-name {
      margin-top: 0;
      /* Ghi đè margin-top 8px mặc định */
      margin-bottom: 4px;
    }

    /* Hover cho class-item */
    .class-item {
      display: block;
      color: inherit;
      text-decoration: none;
      transition: transform 0.3s ease;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    .class-item:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
    }

    .ci-pic img {
      transition: transform 0.5s ease;
    }

    .class-item:hover .ci-pic img {
      transform: scale(1.08);
    }

    /* POPUP ĐĂNG KÝ - HIỆN ĐẠI */
    #register-popup {
      max-width: 720px;
      margin: 40px auto;
      background: #fff;
      padding: 35px;
      border-radius: 20px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
    }

    .popup-subtitle {
      color: #e74c3c;
      font-weight: 500;
      font-size: 0.95rem;
      margin-top: -8px;
    }

    .modern-form .form-row {
      display: flex;
      gap: 16px;
      margin-bottom: 18px;
    }

    .modern-form .form-group {
      flex: 1;
    }

    .modern-form label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 6px;
      font-size: 0.92rem;
    }

    .modern-form .form-control {
      width: 100%;
      padding: 11px 14px;
      border: 1.5px solid #ddd;
      border-radius: 12px;
      background: #f9f9f9;
      font-size: 0.95rem;
      color: #444;
      transition: all 0.3s ease;
      font-family: 'Muli', sans-serif;
      /* Đồng bộ font */
    }

    .modern-form .form-control:focus {
      outline: none;
      border-color: #e74c3c;
      background: #fff;
      box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.15);
    }

    .payment-method {
      display: flex;
      gap: 12px;
    }

    .payment-option {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #eee;
      border-radius: 14px;
      background: #f8f9fa;
      text-align: center;
      cursor: not-allowed;
      transition: all 0.3s ease;
      font-weight: 500;
      color: #555;
    }

    .payment-option.active {
      border-color: #27ae60;
      background: rgba(39, 174, 96, 0.08);
      color: #27ae60;
    }

    .payment-option i {
      margin-right: 6px;
      font-size: 1.1rem;
    }

    .primary-btn,
    .secondary-btn {
      padding: 12px 28px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      font-family: 'Muli', sans-serif;
      /* Đồng bộ font */
    }

    .primary-btn {
      background: #e74c3c;
      color: white;
    }

    .primary-btn:hover {
      background: #c0392b;
      transform: translateY(-2px);
    }

    .secondary-btn {
      background: #f1f1f1;
      color: #666;
      margin-left: 10px;
    }

    .secondary-btn:hover {
      background: #e0e0e0;
    }

    .text-danger {
      color: #e74c3c !important;
    }

    @media (max-width: 576px) {
      .modern-form .form-row {
        flex-direction: column;
        gap: 14px;
      }

      #register-popup {
        padding: 25px 20px;
        margin: 20px;
      }

      .service-popup-modern {
        padding: 25px 20px;
        margin: 20px;
      }
    }
        .search-highlight {
            background-color: #f7b02a;
            color: #000;
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 3px;
            box-shadow: 0 0 10px #f7b02a;
        }
  </style>
</head>

<body>
  <div id="preloder">
    <div class="loader"></div>
  </div>

  <div class="offcanvas-menu-overlay"></div>
  <div class="offcanvas-menu-wrapper">
    <div class="canvas-close"><i class="fa fa-close"></i></div>
    <div class="canvas-search search-switch"><i class="fa fa-search"></i></div>
    <nav class="canvas-menu mobile-menu">
      <ul>
        <li><a href="./index-tv.html">Trang chủ</a></li>
        <li><a href="./about-us-tv.html">Giới thiệu</a></li>
        <li><a href="./services-tv.html">Gói tập</a></li>
        <li><a href="./team-tv.html">Đội ngũ HLV</a></li>
        <li><a href="./bmi-tv.html">Tính BMI</a></li>
        <li><a href="./profile.html">Trang cá nhân </a></li>
        <li><a href="../index.html">Đăng xuất</a></li>
      </ul>
    </nav>
    <div id="mobile-menu-wrap"></div>
    <div class="canvas-social">
      <a href="#"><i class="fa fa-facebook"></i></a>
      <a href="#"><i class="fa fa-twitter"></i></a>
      <a href="#"><i class="fa fa-youtube-play"></i></a>
      <a href="#"><i class="fa fa-instagram"></i></a>
    </div>
  </div>

  <header class="header-section">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-3">
          <div class="logo">
            <a href="./index-tv.html"><img src="../img/logo.png" alt=""></a>
          </div>
        </div>
        <div class="col-lg-6">
          <nav class="nav-menu">
            <ul>
              <li><a href="./index-tv.html">Trang chủ</a></li>
              <li><a href="./about-us-tv.html">Giới thiệu</a></li>
              <li class="active"><a href="./services-tv.html">Gói tập</a></li>
              <li><a href="./team-tv.html">Đội ngũ HLV</a></li>
              <li><a href="./bmi-tv.html">Tính BMI</a></li>
              <li><a href="./profile.html">Trang cá nhân </a></li>
              <li><a href="../index.html">Đăng xuất</a></li>
            </ul>
          </nav>
        </div>
        <div class="col-lg-3">
          <div class="top-option">
            <div class="to-search search-switch"><i class="fa fa-search"></i></div>
            <div class="to-social">
              <a href="#"><i class="fa fa-facebook"></i></a>
              <a href="#"><i class="fa fa-twitter"></i></a>
              <a href="#"><i class="fa fa-youtube-play"></i></a>
              <a href="#"><i class="fa fa-instagram"></i></a>
            </div>
          </div>
        </div>
      </div>
      <div class="canvas-open"><i class="fa fa-bars"></i></div>
    </div>
  </header>

  <section class="breadcrumb-section set-bg" data-setbg="../img/breadcrumb-bg.jpg">
    <div class="container text-center">
      <div class="breadcrumb-text">
        <h2>Gói tập</h2>
        <div class="bt-option">
          <a href="./index-tv.html">Trang chủ</a>
          <span>Gói tập</span>
        </div>
      </div>
    </div>
  </section>

  <section class="classes-section spad">
    <div class="container">
      <div class="section-title text-center">
        <span>KHÁM PHÁ</span>
        <h2>CÁC GÓI TẬP CỦA CHÚNG TÔI</h2>
      </div>
      <div class="row" id="explore-row"></div>
    </div>
  </section>

  <div id="detail-popups-container"></div>

  <section class="banner-section set-bg" data-setbg="../img/banner-bg.jpg">
    <div class="container text-center">
      <div class="bs-text service-banner">
        <h2>Tập luyện để cơ thể vận hành hoàn hảo</h2>
        <div class="bt-tips">Nơi sức khỏe, sắc đẹp và thể chất hội tụ</div>
        <a href="https://www.youtube.com/watch?v=EzKkl64rRbM" class="play-btn video-popup"><i
            class="fa fa-caret-right"></i></a>
      </div>
    </div>
  </section>

  <section class="pricing-section service-pricing spad">
    <div class="container">
      <div class="section-title text-center">
        <span>Các gói tập của chúng tôi</span>
        <h2>Chọn gói tập của bạn</h2>
      </div>
      <div class="row justify-content-center" id="pricing-row"></div>
    </div>
  </section>

  <div class="gettouch-section">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <div class="gt-text">
            <i class="fa fa-map-marker"></i>
            <p>306 Hồ Tùng Mậu, Phú Diễn, Bắc Từ Liêm<br /> TP.Hà Nội</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="gt-text">
            <i class="fa fa-mobile"></i>
            <ul>
              <li>0968 868 888</li>
              <li>0846 686 888</li>
            </ul>
          </div>
        </div>
        <div class="col-md-4">
          <div class="gt-text email">
            <i class="fa fa-envelope"></i>
            <p>Support.GymLy@gmail.com</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <section class="footer-section">
    <div class="container">
      <div class="row">
        <div class="col-lg-4">
          <div class="fs-about">
            <div class="fa-logo">
              <a href="#"><img src="../img/logo.png" alt=""></a>
            </div>
            <p>Trải nghiệm chương trình tập luyện khoa học, giúp cải thiện sức khỏe, vóc dáng và tăng năng lượng mỗi
              ngày.</p>
            <div class="fa-social">
              <a href="#"><i class="fa fa-facebook"></i></a>
              <a href="#"><i class="fa fa-twitter"></i></a>
              <a href="#"><i class="fa fa-youtube-play"></i></a>
              <a href="#"><i class="fa fa-instagram"></i></a>
              <a href="#"><i class="fa  fa-envelope-o"></i></a>
            </div>
          </div>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-6">
          <div class="fs-widget">
            <h4>Liên kết hữu ích</h4>
            <ul>
              <li><a href="#">Giới thiệu</a></li>
              <li><a href="#">Trang chủ</a></li>
              <li><a href="#">Đầu trang</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-6">
          <div class="fs-widget">
            <h4>Hỗ trợ</h4>
            <ul>
              <li><a href="#">Đăng nhập</a></li>
              <li><a href="#">Gói tập</a></li>
              <li><a href="#">Đội ngũ HLV</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-4 col-md-6">
          <div class="fs-widget">
            <h4>Lời khuyên & Hướng dẫn</h4>
            <div class="fw-recent">
              <h6><a href="#">Tập luyện thể chất giúp phòng ngừa trầm cảm và lo âu</a></h6>
              <ul>
                <li>3 min read</li>
                <li>20 Comment</li>
              </ul>
            </div>
            <div class="fw-recent">
              <h6><a href="#">Thể hình: Bài tập hiệu quả nhất để giảm mỡ bụng và săn cơ</a></h6>
              <ul>
                <li>5 min read</li>
                <li>25 Comment</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12 text-center">
          <div class="copyright-text">
            <p>&copy;
              <script>document.write(new Date().getFullYear());</script> All rights reserved | Welcome to <i
                class="fa fa-heart" aria-hidden="true"></i> <a href="https://colorlib.com" target="_blank">GymLy</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div class="search-model">
    <div class="h-100 d-flex align-items-center justify-content-center">
      <div class="search-close-switch">+</div>
      <form class="search-model-form">
        <input type="text" id="search-input" placeholder="Search here.....">
      </form>
    </div>
  </div>

  <script src="../js/jquery-3.3.1.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script src="../js/jquery.magnific-popup.min.js"></script>
  <script src="../js/masonry.pkgd.min.js"></script>
  <script src="../js/jquery.barfiller.js"></script>
  <script src="../js/jquery.slicknav.js"></script>
  <script src="../js/owl.carousel.min.js"></script>
  <script src="../js/main.js"></script>
  <script src="data.js"></script>

  <script>
    // === DỮ LIỆU MẪU GÓI TẬP (Giữ nguyên) ===
    let packages = [
      {
        id: "yoga",
        name: "Gói Yoga",
        code: "YG",
        basePrice: 300000,
        description: "Giúp bạn cân bằng tinh thần, cải thiện sức khỏe và sự dẻo dai thông qua những bài tập nhẹ nhàng.",
        image: "../img/services/services-1.jpg",
        trainers: [
          { name: "Ngọc Anh", description: "Chuyên gia Yoga với 5 năm kinh nghiệm." },
          { name: "Trần Khánh Ly", description: "Sư phụ Yoga Quốc tế." }
        ],
        benefits: ["Giảm căng thẳng, tăng sự tập trung", "Cải thiện tư thế và sự linh hoạt", "Tăng cường hô hấp và hệ miễn dịch"],
        features: ["Tham gia lớp yoga nhóm", "Miễn phí tư vấn chế độ ăn", "Có HLV riêng", "Thi đấu giao hữu", "Sử dụng phòng phục hồi", "Tập không giới hạn", "Phòng xông hơi", "Locker riêng"]
      },
      {
        id: "boxing",
        name: "Gói Boxing",
        code: "BX",
        basePrice: 300000,
        description: "Tăng sức bền, giảm mỡ, rèn luyện phản xạ và bản lĩnh qua từng cú đấm và di chuyển.",
        image: "../img/services/services-2.jpg",
        trainers: [
          { name: "Hữu Phước", description: "Vô địch boxing nghiệp dư toàn quốc." },
          { name: "Trần Đình Trọng", description: "Chuyên gia Boxing và Cardio." }
        ],
        benefits: ["Giảm mỡ, tăng sức bền", "Giải tỏa căng thẳng, cải thiện phản xạ"],
        features: ["Tham gia lớp boxing nhóm", "Miễn phí tư vấn chế độ ăn", "Có HLV riêng", "Thi đấu giao hữu", "Sử dụng phòng phục hồi", "Tập không giới hạn", "Phòng xông hơi", "Locker riêng"]
      },
      {
        id: "gym",
        name: "Gói Gym",
        code: "G",
        basePrice: 300000,
        description: "Xây dựng cơ thể khỏe mạnh, vóc dáng cân đối cùng các bài tập được thiết kế riêng cho từng mục tiêu.",
        image: "../img/services/services-3.jpg",
        trainers: [
          { name: "Minh Tú", description: "Chuyên gia thể hình, đạt chứng chỉ NASM quốc tế." }
        ],
        benefits: ["Tăng cơ, giảm mỡ hiệu quả", "Cải thiện sức khỏe tim mạch", "Hình thể săn chắc, khỏe mạnh"],
        features: ["Tham gia lớp gym nhóm", "Miễn phí tư vấn chế độ ăn", "Có HLV riêng", "Thi đấu giao hữu", "Sử dụng phòng phục hồi", "Tập không giới hạn", "Phòng xông hơi", "Locker riêng"]
      }
    ];

    function loadPackages() {
      // Cập nhật để ưu tiên tải gói tập từ LocalStorage (do admin có thể cập nhật)
      const saved = localStorage.getItem('gymLy_packages');
      if (saved) {
        try {
          let savedPackages = JSON.parse(saved);
          const formattedPackages = savedPackages.map(p => ({
            id: p.name.toLowerCase(), // Dùng tên để làm ID
            name: `Gói ${p.name}`,
            code: p.name.substring(0, 2).toUpperCase(),
            basePrice: p.price,
            description: p.quyenloi || "Mô tả gói tập đang được cập nhật.",
            image: `../img/services/services-${p.name === 'Yoga' ? 1 : (p.name === 'Boxing' ? 2 : 3)}.jpg`,
            trainers: [
              { name: p.hlv || "Đội ngũ HLV", description: `Chuyên gia ${p.name}` }
            ],
            benefits: ["Lợi ích đang cập nhật..."],
            features: [p.quyenloi || "Quyền lợi đang cập nhật..."]
          }));

          packages = formattedPackages.filter(pkg =>
            pkg && typeof pkg.id === 'string' && pkg.id.trim() !== '' && typeof pkg.basePrice === 'number'
          );

          if (packages.length === 0) {
            packages = getDefaultPackages();
          }
        } catch (e) {
          console.error("Lỗi parse localStorage, sử dụng data gốc.", e);
          packages = getDefaultPackages();
        }
      } else {
        packages = getDefaultPackages();
      }
    }

    // Hàm cung cấp dữ liệu gói tập mặc định
    function getDefaultPackages() {
      // Trả về mảng mặc định ban đầu
      return [
        {
          id: "yoga", name: "Gói Yoga", code: "YG", basePrice: 300000, description: "Giúp bạn cân bằng tinh thần, cải thiện sức khỏe và sự dẻo dai thông qua những bài tập nhẹ nhàng.",
          image: "../img/services/services-1.jpg",
          trainers: [{ name: "Ngọc Anh", description: "Chuyên gia Yoga với 5 năm kinh nghiệm." }, { name: "Trần Khánh Ly", description: "Sư phụ Yoga Quốc tế." }],
          benefits: ["Giảm căng thẳng, tăng sự tập trung", "Cải thiện tư thế và sự linh hoạt", "Tăng cường hô hấp và hệ miễn dịch"],
          features: ["Tham gia lớp yoga nhóm", "Miễn phí tư vấn chế độ ăn", "Có HLV riêng", "Thi đấu giao hữu", "Sử dụng phòng phục hồi", "Tập không giới hạn", "Phòng xông hơi", "Locker riêng"]
        },
        {
          id: "boxing", name: "Gói Boxing", code: "BX", basePrice: 300000, description: "Tăng sức bền, giảm mỡ, rèn luyện phản xạ và bản lĩnh qua từng cú đấm và di chuyển.",
          image: "../img/services/services-2.jpg",
          trainers: [{ name: "Hữu Phước", description: "Vô địch boxing nghiệp dư." }, { name: "Trần Đình Trọng", description: "Chuyên gia Boxing và Cardio." }],
          benefits: ["Giảm mỡ, tăng sức bền", "Giải tỏa căng thẳng, cải thiện phản xạ"],
          features: ["Tham gia lớp boxing nhóm", "Miễn phí tư vấn chế độ ăn", "Có HLV riêng", "Thi đấu giao hữu", "Sử dụng phòng phục hồi", "Tập không giới hạn", "Phòng xông hơi", "Locker riêng"]
        },
        {
          id: "gym", name: "Gói Gym", code: "G", basePrice: 300000, description: "Xây dựng cơ thể khỏe mạnh, vóc dáng cân đối cùng các bài tập được thiết kế riêng cho từng mục tiêu.",
          image: "../img/services/services-3.jpg",
          trainers: [{ name: "Minh Tú", description: "Chuyên gia thể hình, NASM quốc tế." }],
          benefits: ["Tăng cơ, giảm mỡ hiệu quả", "Cải thiện sức khỏe tim mạch", "Hình thể săn chắc, khỏe mạnh"],
          features: ["Tham gia lớp gym nhóm", "Miễn phí tư vấn chế độ ăn", "Có HLV riêng", "Thi đấu giao hữu", "Sử dụng phòng phục hồi", "Tập không giới hạn", "Phòng xông hơi", "Locker riêng"]
        }
      ];
    }

    function renderExplore() {
      const row = document.getElementById('explore-row');
      row.innerHTML = '';
      packages.forEach(pkg => {
        row.innerHTML += `
          <div class="col-lg-4 col-md-6">
            <a href="#${pkg.id}-detail-popup" class="class-item popup-with-zoom-anim">
              <div class="ci-pic">
                <img src="${pkg.image}" alt="${pkg.name}">
              </div>
              <div class="ci-text">
                <span>${pkg.code}</span>
                <h5>${pkg.name.replace('Gói ', '')}</h5>
                <i class="fa fa-angle-right"></i>
              </div>
            </a>
          </div>`;
      });
      initPopups();
    }

    // === HÀM RENDER PRICING ===
    function renderPricing() {
      const row = document.getElementById('pricing-row');
      row.innerHTML = '';
      packages.forEach(pkg => {
        row.innerHTML += `
          <div class="col-lg-4 col-md-8 package-item" data-id="${pkg.id}">
            <div class="ps-item text-center">
              <h3>${pkg.name} <small>(Mã: ${pkg.code})</small></h3>
              <div class="pi-price">
                <h2 class="display-price">${pkg.basePrice.toLocaleString('vi-VN')} VNĐ</h2>
                <span>Giá / 1 tháng</span>
              </div>
              <a href="#" class="primary-btn pricing-btn d-block text-center mt-4">Đăng ký ngay</a>
            </div>
          </div>`;
      });
    }

    // === HÀM RENDER POPUP CHI TIẾT ===
    function renderDetailPopups() {
      const container = document.getElementById('detail-popups-container');
      container.innerHTML = '';
      packages.forEach(pkg => {

        // Tạo HTML cho danh sách HLV
        const trainersHtml = (pkg.trainers && pkg.trainers.length > 0)
          ? pkg.trainers.map(t => `
            <div class="trainer-item">
              <p class="trainer-name"><strong>${t.name}</strong></p>
              <p class="trainer-desc">${t.description}</p>
            </div>
          `).join('')
          : '<p class="trainer-desc">Chưa có HLV phụ trách.</p>';

        container.innerHTML += `
          <div id="${pkg.id}-detail-popup" class="zoom-anim-dialog mfp-hide service-popup-modern">
            <div class="popup-header text-center mb-4">
              <h3 class="popup-title">${pkg.name}</h3>
              <p class="popup-code">Mã gói: <strong>${pkg.code}</strong></p>
            </div>
            <img src="${pkg.image}" alt="${pkg.name}" class="img-fluid rounded shadow-sm mb-4 mx-auto d-block" style="max-height: 280px; object-fit: cover;">
            
            <div class="row">
              <div class="col-md-6 mb-4">
                <h5 class="section-subtitle">Lợi ích</h5>
                <ul class="benefit-list">
                  ${(pkg.benefits || []).map(b => `<li>${b}</li>`).join('')}
                </ul>
              </div>
              <div class="col-md-6 mb-4">
                <h5 class="section-subtitle">Quyền lợi</h5>
                <ul class="feature-list">
                  ${(pkg.features || []).map(f => `<li>${f}</li>`).join('')}
                </ul>
              </div>
            </div>

            <hr class="my-4">

            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="trainer-info text-center">
                  <h5 class="section-subtitle" style="justify-content: center;">Huấn luyện viên</h5>
                  ${trainersHtml} </div>
              </div>
              <div class="col-md-6">
                <div class="text-center">
                  <h5 class="section-subtitle" style="justify-content: center;">Giá gói</h5>
                  <div class="pi-price" style="margin-bottom: 0;">
                    <h2 style="font-size: 2.2rem; color: #e74c3c; margin-bottom: 0;">${pkg.basePrice.toLocaleString('vi-VN')} VNĐ</h2>
                    <span style="font-size: 1rem;">/ tháng</span>
                  </div>
                </div>
              </div>
            </div>

            <hr class="my-4">

            <div class="text-center mt-4">
              <button type="button" class="primary-btn popup-register-btn" data-id="${pkg.id}">Đăng ký ngay</button>
              <button type="button" class="secondary-btn" onclick="$.magnificPopup.close()">Đóng</button>
            </div>
          </div>`;
      });
      initPopups();
    }

    function initPopups() {
      if (typeof $ === 'function' && typeof $.fn.magnificPopup === 'function') {
        $('.popup-with-zoom-anim').magnificPopup({
          type: 'inline',
          fixedContentPos: false,
          fixedBgPos: true,
          overflowY: 'auto',
          closeBtnInside: true,
          preloader: false,
          midClick: true,
          removalDelay: 300,
          mainClass: 'my-mfp-zoom-in'
        });
      }
    }

    function formatDateToMySQL(date) {
      const d = date instanceof Date ? date : new Date(date);
      let month = '' + (d.getMonth() + 1);
      let day = '' + d.getDate();
      const year = d.getFullYear();

      if (month.length < 2)
        month = '0' + month;
      if (day.length < 2)
        day = '0' + day;

      return [year, month, day].join('-');
    }

    // === HÀM Hỗ trợ mở popup đăng ký (Cập nhật để hiển thị Mã TV) ===
    // === HÀM Hỗ trợ mở popup đăng ký (Đã loại bỏ Mã TV) ===
    function openRegisterPopup(pkg, packageNameWithDuration, price) {
      const paymentCode = 'PAY' + Date.now().toString().slice(-6) + Math.random().toString(36).substr(2, 2).toUpperCase();
      // Logic lấy user/memberCode đã được di chuyển sang hàm submit

      document.getElementById('payment-code').value = paymentCode;
      // document.getElementById('member-code').value đã bị xóa khỏi DOM và khỏi code JS
      document.getElementById('package-code').value = pkg.code;
      document.getElementById('package-name').value = packageNameWithDuration;
      document.getElementById('total-price').value = price.toLocaleString('vi-VN') + ' VNĐ';
      document.getElementById('payment-date').value = new Date().toLocaleDateString('vi-VN');

      setTimeout(() => {
        $.magnificPopup.open({
          items: { src: '#register-popup' },
          type: 'inline',
          fixedContentPos: false,
          fixedBgPos: true,
          overflowY: 'auto',
          closeBtnInside: true,
          preloader: false,
          midClick: true,
          removalDelay: 300,
          mainClass: 'my-mfp-zoom-in'
        });
      }, 300);
    }

    // === HÀM SỰ KIỆN ĐĂNG KÝ (Cập nhật logic thanh toán và lưu data) ===
    // === HÀM SỰ KIỆN ĐĂNG KÝ (Sử dụng Fetch API để gửi dữ liệu đến PHP) ===
    function attachRegisterEvents() {
      document.querySelectorAll('.pricing-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.preventDefault();

          const packageItem = this.closest('.package-item');
          const pkg = packages.find(p => p.id === packageItem.dataset.id);
          if (!pkg) return;

          // Gói tập mặc định 1 tháng
          const packageNameWithDuration = `${pkg.name.replace('Gói ', '')} (1 tháng)`;
          const totalPrice = pkg.basePrice;

          openRegisterPopup(pkg, packageNameWithDuration, totalPrice);
        });
      });

      document.getElementById('register-form').addEventListener('submit', function (e) {
        e.preventDefault();

        // services-tv.html (Trong hàm attachRegisterEvents, khoảng Dòng 448)

        // 1. LẤY DỮ LIỆU TỪ LOCALSTORAGE VÀ FORM
        const user = JSON.parse(localStorage.getItem('gymUser'));

        // => FIX: Thêm user.memberId vào danh sách kiểm tra
        const memberId = user ? (user.id || user.maTV || user.memberId) : null;

        // ...
        // Kiểm tra đăng nhập
        if (!memberId || memberId === 'CHƯA ĐĂNG NHẬP') {
          alert('Dữ liệu đăng nhập cũ không hợp lệ. Vui lòng đăng nhập lại!');
          localStorage.removeItem('gymUser');
          window.location.href = '../account.html';
          return;
          $.magnificPopup.close();
          return;
        }
        // ...

        const packageName = document.getElementById('package-name').value;
        const totalPriceText = document.getElementById('total-price').value;

        // Kiểm tra đăng nhập
        if (!memberId || memberId === 'CHƯA ĐĂNG NHẬP') {
          alert('Dữ liệu đăng nhập cũ không hợp lệ. Vui lòng đăng nhập lại!');
          localStorage.removeItem('gymUser');
          window.location.href = '../account.html';
          return;
          $.magnificPopup.close();
          return;
        }

        // Lấy giá trị số thực (loại bỏ ký tự không phải số)
        const priceValue = parseInt(totalPriceText.replace(/[^\d]/g, ''));

        // 2. TÍNH TOÁN NGÀY BẮT ĐẦU & NGÀY KẾT THÚC
        const pkgDuration = packageName.includes('(3 tháng)') ? 3 : 1;

        const currentDate = new Date();
        const startDate = formatDateToMySQL(currentDate); // YYYY-MM-DD

        const endDate = new Date(currentDate);
        endDate.setMonth(endDate.getMonth() + pkgDuration); // Tăng số tháng
        const endDateString = formatDateToMySQL(endDate); // YYYY-MM-DD

        // 3. Chuẩn bị Dữ liệu gửi đi (JSON Payload)
        const paymentData = {
          memberId: memberId,
          goitap: packageName,
          thanhtoan: priceValue,
          ngaybatdau: startDate,
          ngayketthuc: endDateString
        };

        // 4. GỬI DỮ LIỆU ĐẾN PHP (dangky_goitap.php)
        fetch('../dangky_goitap.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(paymentData),
        })
          .then(response => {
            if (!response.ok) { // Xử lý lỗi HTTP (4xx, 5xx)
              return response.json().then(errorData => {
                throw new Error(errorData.message || 'Lỗi server không xác định.');
              });
            }
            return response.json();
          })
          .then(result => {
            if (result.success) {
              alert('✅ Thanh toán thành công! Gói tập ' + packageName + ' đã được kích hoạt.');

              // Cập nhật lại LocalStorage sau khi thanh toán thành công
              const user = JSON.parse(localStorage.getItem('gymUser'));
              localStorage.setItem('gymUser', JSON.stringify({
                ...user,
                goitap: packageName,
                ngaybatdau: startDate,
                ngayketthuc: endDateString,
                // Giả định tổng thanh toán được tính ở PHP
              }));

              $.magnificPopup.close();
              // Tùy chọn: Tải lại trang để cập nhật thông tin thành viên ở Header/Profile
              // window.location.reload(); 
            } else {
              alert('Lỗi đăng ký gói tập: ' + (result.message || 'Không rõ lỗi.'));
            }
          })
          .catch(error => {
            console.error('Lỗi Fetch:', error);
            alert('Lỗi kết nối hoặc xử lý server: ' + error.message);
          });
      });
    }

    // === HÀM SỰ KIỆN ĐĂNG KÝ (TỪ POPUP CHI TIẾT) ===
    function attachPopupRegisterEvents() {
      document.addEventListener('click', function (e) {
        let targetButton = e.target.closest('.popup-register-btn');
        if (targetButton) {
          e.preventDefault();
          const pkgId = targetButton.dataset.id;
          const pkg = packages.find(p => p.id === pkgId);
          if (!pkg) return;

          const packageNameWithDuration = `${pkg.name.replace('Gói ', '')}(1 tháng)`;

          $.magnificPopup.close();
          openRegisterPopup(pkg, packageNameWithDuration, pkg.basePrice);
        }
      });
    }

    // --- CHẠY KHI TẢI TRANG ---
    document.addEventListener('DOMContentLoaded', function () {
      // Tải dữ liệu gói tập từ LocalStorage
      loadPackages();

      renderExplore();
      renderPricing();
      renderDetailPopups();
      attachRegisterEvents();
      attachPopupRegisterEvents();

      //
    });
    // --- CHẠY KHI TẢI TRANG ---
    document.addEventListener('DOMContentLoaded', function () {
      // 1. Tải dữ liệu gói tập (từ LocalStorage hoặc mặc định)
      loadPackages();

      // 2. Render các gói tập ở mục 'KHÁM PHÁ'
      renderExplore();

      // 3. Tạo các popup chi tiết cho từng gói tập
      renderDetailPopups();

      // 4. Render các gói tập ở mục 'CHỌN GÓI TẬP CỦA BẠN'
      renderPricing();

      // 5. Gắn sự kiện đăng ký cho các nút trong phần Pricing
      attachRegisterEvents();

      // 6. Gắn sự kiện đăng ký cho các nút trong Popup chi tiết
      attachPopupRegisterEvents();
    }); // <-- Đây là phần bị thiếu và cần được bổ sung
  </script>

  <div id="register-popup" class="zoom-anim-dialog mfp-hide service-popup-modern">
    <div class="popup-header text-center mb-4">
      <h3 class="popup-title">Xác nhận đăng ký gói tập</h3>
      <p class="popup-subtitle">Vui lòng kiểm tra thông tin trước khi thanh toán</p>
    </div>

    <form id="register-form" class="modern-form">
      <div class="form-row">
        <div class="form-group">
          <label>Mã thanh toán</label>
          <input type="text" id="payment-code" readonly class="form-control">
        </div>

      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Mã gói</label>
          <input type="text" id="package-code" readonly class="form-control">
        </div>
        <div class="form-group">
          <label>Gói tập</label>
          <input type="text" id="package-name" readonly class="form-control">
        </div>
      </div>

      <div class="form-group">
        <label>Phương thức thanh toán</label>
        <div class="payment-method">
          <label class="payment-option active">
            <input type="radio" name="payment" value="card" checked disabled>
            <i class="fa fa-credit-card"></i> Thẻ ngân hàng
          </label>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Tổng tiền</label>
          <input type="text" id="total-price" readonly class="form-control text-danger font-weight-bold">
        </div>
        <div class="form-group">
          <label>Ngày thanh toán</label>
          <input type="text" id="payment-date" readonly class="form-control">
        </div>
      </div>

      <div class="text-center mt-4">
        <button type="submit" class="primary-btn">Xác nhận thanh toán</button>
        <button type="button" class="secondary-btn ml-2" onclick="$.magnificPopup.close()">Hủy</button>
      </div>
    </form>
  </div>
<script>
    // ==========================================
    // 1. PHẦN LOGIC TÌM KIẾM (NEW FEATURE)
    // ==========================================
    $(document).ready(function() {
        // Hàm thực hiện tìm kiếm
        function performSearch(e) {
            e.preventDefault(); // Ngăn form reload
            
            var keyword = $('#search-input').val().trim();
            
            // Xóa các highlight cũ
            $('.search-highlight').each(function() {
                $(this).replaceWith($(this).html());
            });

            if (keyword === "") {
                alert("Vui lòng nhập từ khóa tìm kiếm!");
                return;
            }

            // Tìm kiếm trong nội dung trang (trừ thẻ script, style)
            var contentArea = $('body'); 
            var found = false;

            // Quét qua các node text
            contentArea.find('*').contents().filter(function() {
                // Chỉ lấy text node, và không nằm trong script/style
                return this.nodeType === 3 && 
                       this.nodeValue.trim() !== "" &&
                       $(this).parent().prop("tagName") !== "SCRIPT" &&
                       $(this).parent().prop("tagName") !== "STYLE";
            }).each(function() {
                var textNode = $(this);
                var textContent = textNode.text();
                
                // Regex tìm kiếm không phân biệt hoa thường
                var regex = new RegExp("(" + keyword + ")", "gi");
                
                if (regex.test(textContent)) {
                    found = true;
                    // Bọc từ khóa tìm thấy vào thẻ span
                    var newHtml = textContent.replace(regex, '<span class="search-highlight">$1</span>');
                    $(this).replaceWith(newHtml);
                }
            });

            if (found) {
                // Đóng khung search
                $('.search-model').fadeOut(400);
                $('#search-input').val(''); // Xóa input sau khi tìm

                // Cuộn tới kết quả đầu tiên
                var firstResult = $('.search-highlight').first();
                $('html, body').animate({
                    scrollTop: firstResult.offset().top - 150
                }, 800);
            } else {
                alert('Không tìm thấy kết quả nào cho: "' + keyword + '"');
            }
        }

        // Bắt sự kiện nhấn Enter trong ô input
        $('#search-input').on('keypress', function(e) {
            if(e.which == 13) {
                performSearch(e);
            }
        });
        
        // Bắt sự kiện submit form (dự phòng)
        $('.search-model-form').on('submit', function(e) {
            performSearch(e);
        });
    });
</script>
<script>
    // ==========================================
    // 1. PHẦN LOGIC TÌM KIẾM (NEW FEATURE)
    // ==========================================
    $(document).ready(function() {
        // Hàm thực hiện tìm kiếm
        function performSearch(e) {
            e.preventDefault(); // Ngăn form reload
            
            var keyword = $('#search-input').val().trim();
            
            // Xóa các highlight cũ
            $('.search-highlight').each(function() {
                $(this).replaceWith($(this).html());
            });

            if (keyword === "") {
                alert("Vui lòng nhập từ khóa tìm kiếm!");
                return;
            }

            // Tìm kiếm trong nội dung trang (trừ thẻ script, style)
            var contentArea = $('body'); 
            var found = false;

            // Quét qua các node text
            contentArea.find('*').contents().filter(function() {
                // Chỉ lấy text node, và không nằm trong script/style
                return this.nodeType === 3 && 
                       this.nodeValue.trim() !== "" &&
                       $(this).parent().prop("tagName") !== "SCRIPT" &&
                       $(this).parent().prop("tagName") !== "STYLE";
            }).each(function() {
                var textNode = $(this);
                var textContent = textNode.text();
                
                // Regex tìm kiếm không phân biệt hoa thường
                var regex = new RegExp("(" + keyword + ")", "gi");
                
                if (regex.test(textContent)) {
                    found = true;
                    // Bọc từ khóa tìm thấy vào thẻ span
                    var newHtml = textContent.replace(regex, '<span class="search-highlight">$1</span>');
                    $(this).replaceWith(newHtml);
                }
            });

            if (found) {
                // Đóng khung search
                $('.search-model').fadeOut(400);
                $('#search-input').val(''); // Xóa input sau khi tìm

                // Cuộn tới kết quả đầu tiên
                var firstResult = $('.search-highlight').first();
                $('html, body').animate({
                    scrollTop: firstResult.offset().top - 150
                }, 800);
            } else {
                alert('Không tìm thấy kết quả nào cho: "' + keyword + '"');
            }
        }

        // Bắt sự kiện nhấn Enter trong ô input
        $('#search-input').on('keypress', function(e) {
            if(e.which == 13) {
                performSearch(e);
            }
        });
        
        // Bắt sự kiện submit form (dự phòng)
        $('.search-model-form').on('submit', function(e) {
            performSearch(e);
        });
    });
</script>
</body>

</html>